unit ULexico;

interface

uses UToken, ULexicalError, UConstants, SysUtils;

type
    TLexico = class
    public
        constructor create; overload;
        constructor create(input : string); overload;

        procedure setInput(input : string);
        procedure setPosition(pos : integer);
        procedure setEnd(endPos : integer);
        function nextToken : TToken; //raises ELexicalError

    private
        input : string;
        position : integer;
        endPos : integer;

        function nextState(c : char; state : integer) : integer;
        function tokenForState(state : integer) : integer;
        function lookupToken(base : integer; key : string) : integer;

        function hasInput : boolean;
        function nextChar : char;
    end;

implementation

constructor TLexico.create;
begin
    setInput('');
end;

constructor TLexico.create(input : string);
begin
    setInput(input);
end;

procedure TLexico.setInput(input : string);
begin
    self.input := input;
    setPosition(1);
    setEnd(Length(input));
end;

function TLexico.nextToken : TToken;
var
    start,
    oldState,
    state,
    endState,
    endPos,
    token : integer;
    lexeme : string;
begin
    if not hasInput then
        result := nil
    else
    begin
        start := position;

        state := 0;
        oldState := 0;
        endState := -1;
        endPos := -1;

        while hasInput do
        begin
            oldState := state;
            state := nextState(nextChar, state);

            if state < 0 then
                break

            else
            begin
                if tokenForState(state) >= 0 then
                begin
                    endState := state;
                    endPos := position;
                end;
            end;
        end;
        if (endState < 0) or ( (endState <> state) and (tokenForState(oldState) = -2) ) then
            raise ELexicalError.create(SCANNER_ERROR[oldState], start);

        position := endPos;

        token := tokenForState(endState);

        if token = 0 then
            result := nextToken
        else
        begin
            lexeme := Copy(input, start, endPos-start);
            token  := lookupToken(token, lexeme);
            result := TToken.create(token, lexeme, start);
        end;
    end;
end;

procedure TLexico.setPosition(pos : integer);
begin
    position := pos;
end;

procedure TLexico.setEnd(endPos : integer);
begin
    self.endPos := endPos;
end;

function TLexico.nextState(c : char; state : integer) : integer;
begin
    case state of
        0: case integer(c) of
            9: result := 1;
            10: result := 1;
            13: result := 1;
            32: result := 1;
            33: result := 2;
            34: result := 3;
            35: result := 4;
            38: result := 5;
            40: result := 6;
            41: result := 7;
            42: result := 8;
            43: result := 9;
            44: result := 10;
            45: result := 11;
            46: result := 12;
            47: result := 13;
            48: result := 14;
            49: result := 15;
            50: result := 15;
            51: result := 15;
            52: result := 15;
            53: result := 15;
            54: result := 15;
            55: result := 15;
            56: result := 15;
            57: result := 15;
            58: result := 16;
            59: result := 17;
            60: result := 18;
            61: result := 19;
            62: result := 20;
            65: result := 21;
            66: result := 21;
            67: result := 21;
            68: result := 21;
            69: result := 21;
            70: result := 21;
            71: result := 21;
            72: result := 21;
            73: result := 21;
            74: result := 21;
            75: result := 21;
            76: result := 21;
            77: result := 21;
            78: result := 21;
            79: result := 21;
            80: result := 21;
            81: result := 21;
            82: result := 21;
            83: result := 21;
            84: result := 21;
            85: result := 21;
            86: result := 21;
            87: result := 21;
            88: result := 21;
            89: result := 21;
            90: result := 21;
            97: result := 21;
            98: result := 21;
            99: result := 21;
            100: result := 21;
            101: result := 21;
            102: result := 21;
            103: result := 21;
            104: result := 21;
            105: result := 21;
            106: result := 21;
            107: result := 21;
            108: result := 21;
            109: result := 21;
            110: result := 21;
            111: result := 21;
            112: result := 21;
            113: result := 21;
            114: result := 21;
            115: result := 21;
            116: result := 21;
            117: result := 21;
            118: result := 21;
            119: result := 21;
            120: result := 21;
            121: result := 21;
            122: result := 21;
            124: result := 22;
            else result := -1;
        end;
        2: case integer(c) of
            61: result := 23;
            else result := -1;
        end;
        3: case integer(c) of
            9: result := 3;
            13: result := 3;
            32: result := 3;
            33: result := 3;
            34: result := 24;
            35: result := 3;
            36: result := 3;
            37: result := 3;
            38: result := 3;
            39: result := 3;
            40: result := 3;
            41: result := 3;
            42: result := 3;
            43: result := 3;
            44: result := 3;
            45: result := 3;
            46: result := 3;
            47: result := 3;
            48: result := 3;
            49: result := 3;
            50: result := 3;
            51: result := 3;
            52: result := 3;
            53: result := 3;
            54: result := 3;
            55: result := 3;
            56: result := 3;
            57: result := 3;
            58: result := 3;
            59: result := 3;
            60: result := 3;
            61: result := 3;
            62: result := 3;
            63: result := 3;
            64: result := 3;
            65: result := 3;
            66: result := 3;
            67: result := 3;
            68: result := 3;
            69: result := 3;
            70: result := 3;
            71: result := 3;
            72: result := 3;
            73: result := 3;
            74: result := 3;
            75: result := 3;
            76: result := 3;
            77: result := 3;
            78: result := 3;
            79: result := 3;
            80: result := 3;
            81: result := 3;
            82: result := 3;
            83: result := 3;
            84: result := 3;
            85: result := 3;
            86: result := 3;
            87: result := 3;
            88: result := 3;
            89: result := 3;
            90: result := 3;
            91: result := 3;
            93: result := 3;
            94: result := 3;
            95: result := 3;
            96: result := 3;
            97: result := 3;
            98: result := 3;
            99: result := 3;
            100: result := 3;
            101: result := 3;
            102: result := 3;
            103: result := 3;
            104: result := 3;
            105: result := 3;
            106: result := 3;
            107: result := 3;
            108: result := 3;
            109: result := 3;
            110: result := 3;
            111: result := 3;
            112: result := 3;
            113: result := 3;
            114: result := 3;
            115: result := 3;
            116: result := 3;
            117: result := 3;
            118: result := 3;
            119: result := 3;
            120: result := 3;
            121: result := 3;
            122: result := 3;
            123: result := 3;
            124: result := 3;
            125: result := 3;
            126: result := 3;
            161: result := 3;
            162: result := 3;
            163: result := 3;
            164: result := 3;
            165: result := 3;
            166: result := 3;
            167: result := 3;
            168: result := 3;
            169: result := 3;
            170: result := 3;
            171: result := 3;
            172: result := 3;
            173: result := 3;
            174: result := 3;
            175: result := 3;
            176: result := 3;
            177: result := 3;
            178: result := 3;
            179: result := 3;
            180: result := 3;
            181: result := 3;
            182: result := 3;
            183: result := 3;
            184: result := 3;
            185: result := 3;
            186: result := 3;
            187: result := 3;
            188: result := 3;
            189: result := 3;
            190: result := 3;
            191: result := 3;
            192: result := 3;
            193: result := 3;
            194: result := 3;
            195: result := 3;
            196: result := 3;
            197: result := 3;
            198: result := 3;
            199: result := 3;
            200: result := 3;
            201: result := 3;
            202: result := 3;
            203: result := 3;
            204: result := 3;
            205: result := 3;
            206: result := 3;
            207: result := 3;
            208: result := 3;
            209: result := 3;
            210: result := 3;
            211: result := 3;
            212: result := 3;
            213: result := 3;
            214: result := 3;
            215: result := 3;
            216: result := 3;
            217: result := 3;
            218: result := 3;
            219: result := 3;
            220: result := 3;
            221: result := 3;
            222: result := 3;
            223: result := 3;
            224: result := 3;
            225: result := 3;
            226: result := 3;
            227: result := 3;
            228: result := 3;
            229: result := 3;
            230: result := 3;
            231: result := 3;
            232: result := 3;
            233: result := 3;
            234: result := 3;
            235: result := 3;
            236: result := 3;
            237: result := 3;
            238: result := 3;
            239: result := 3;
            240: result := 3;
            241: result := 3;
            242: result := 3;
            243: result := 3;
            244: result := 3;
            245: result := 3;
            246: result := 3;
            247: result := 3;
            248: result := 3;
            249: result := 3;
            250: result := 3;
            251: result := 3;
            252: result := 3;
            253: result := 3;
            254: result := 3;
            255: result := 3;
            else result := -1;
        end;
        4: case integer(c) of
            66: result := 25;
            88: result := 26;
            98: result := 25;
            120: result := 26;
            else result := -1;
        end;
        9: case integer(c) of
            61: result := 27;
            else result := -1;
        end;
        11: case integer(c) of
            61: result := 28;
            else result := -1;
        end;
        13: case integer(c) of
            42: result := 29;
            47: result := 30;
            else result := -1;
        end;
        14: case integer(c) of
            46: result := 31;
            else result := -1;
        end;
        15: case integer(c) of
            46: result := 31;
            48: result := 15;
            49: result := 15;
            50: result := 15;
            51: result := 15;
            52: result := 15;
            53: result := 15;
            54: result := 15;
            55: result := 15;
            56: result := 15;
            57: result := 15;
            else result := -1;
        end;
        19: case integer(c) of
            61: result := 32;
            else result := -1;
        end;
        21: case integer(c) of
            48: result := 21;
            49: result := 21;
            50: result := 21;
            51: result := 21;
            52: result := 21;
            53: result := 21;
            54: result := 21;
            55: result := 21;
            56: result := 21;
            57: result := 21;
            65: result := 21;
            66: result := 21;
            67: result := 21;
            68: result := 21;
            69: result := 21;
            70: result := 21;
            71: result := 21;
            72: result := 21;
            73: result := 21;
            74: result := 21;
            75: result := 21;
            76: result := 21;
            77: result := 21;
            78: result := 21;
            79: result := 21;
            80: result := 21;
            81: result := 21;
            82: result := 21;
            83: result := 21;
            84: result := 21;
            85: result := 21;
            86: result := 21;
            87: result := 21;
            88: result := 21;
            89: result := 21;
            90: result := 21;
            95: result := 33;
            97: result := 21;
            98: result := 21;
            99: result := 21;
            100: result := 21;
            101: result := 21;
            102: result := 21;
            103: result := 21;
            104: result := 21;
            105: result := 21;
            106: result := 21;
            107: result := 21;
            108: result := 21;
            109: result := 21;
            110: result := 21;
            111: result := 21;
            112: result := 21;
            113: result := 21;
            114: result := 21;
            115: result := 21;
            116: result := 21;
            117: result := 21;
            118: result := 21;
            119: result := 21;
            120: result := 21;
            121: result := 21;
            122: result := 21;
            else result := -1;
        end;
        25: case integer(c) of
            48: result := 34;
            49: result := 34;
            else result := -1;
        end;
        26: case integer(c) of
            48: result := 35;
            49: result := 35;
            50: result := 35;
            51: result := 35;
            52: result := 35;
            53: result := 35;
            54: result := 35;
            55: result := 35;
            56: result := 35;
            57: result := 35;
            97: result := 35;
            98: result := 35;
            99: result := 35;
            100: result := 35;
            101: result := 35;
            102: result := 35;
            else result := -1;
        end;
        29: case integer(c) of
            9: result := 29;
            10: result := 29;
            13: result := 29;
            32: result := 29;
            33: result := 29;
            34: result := 29;
            35: result := 29;
            36: result := 29;
            37: result := 29;
            38: result := 29;
            39: result := 29;
            40: result := 29;
            41: result := 29;
            42: result := 36;
            43: result := 29;
            44: result := 29;
            45: result := 29;
            46: result := 29;
            47: result := 29;
            48: result := 29;
            49: result := 29;
            50: result := 29;
            51: result := 29;
            52: result := 29;
            53: result := 29;
            54: result := 29;
            55: result := 29;
            56: result := 29;
            57: result := 29;
            58: result := 29;
            59: result := 29;
            60: result := 29;
            61: result := 29;
            62: result := 29;
            63: result := 29;
            64: result := 29;
            65: result := 29;
            66: result := 29;
            67: result := 29;
            68: result := 29;
            69: result := 29;
            70: result := 29;
            71: result := 29;
            72: result := 29;
            73: result := 29;
            74: result := 29;
            75: result := 29;
            76: result := 29;
            77: result := 29;
            78: result := 29;
            79: result := 29;
            80: result := 29;
            81: result := 29;
            82: result := 29;
            83: result := 29;
            84: result := 29;
            85: result := 29;
            86: result := 29;
            87: result := 29;
            88: result := 29;
            89: result := 29;
            90: result := 29;
            91: result := 29;
            92: result := 29;
            93: result := 29;
            94: result := 29;
            95: result := 29;
            96: result := 29;
            97: result := 29;
            98: result := 29;
            99: result := 29;
            100: result := 29;
            101: result := 29;
            102: result := 29;
            103: result := 29;
            104: result := 29;
            105: result := 29;
            106: result := 29;
            107: result := 29;
            108: result := 29;
            109: result := 29;
            110: result := 29;
            111: result := 29;
            112: result := 29;
            113: result := 29;
            114: result := 29;
            115: result := 29;
            116: result := 29;
            117: result := 29;
            118: result := 29;
            119: result := 29;
            120: result := 29;
            121: result := 29;
            122: result := 29;
            123: result := 29;
            124: result := 29;
            125: result := 29;
            126: result := 29;
            161: result := 29;
            162: result := 29;
            163: result := 29;
            164: result := 29;
            165: result := 29;
            166: result := 29;
            167: result := 29;
            168: result := 29;
            169: result := 29;
            170: result := 29;
            171: result := 29;
            172: result := 29;
            173: result := 29;
            174: result := 29;
            175: result := 29;
            176: result := 29;
            177: result := 29;
            178: result := 29;
            179: result := 29;
            180: result := 29;
            181: result := 29;
            182: result := 29;
            183: result := 29;
            184: result := 29;
            185: result := 29;
            186: result := 29;
            187: result := 29;
            188: result := 29;
            189: result := 29;
            190: result := 29;
            191: result := 29;
            192: result := 29;
            193: result := 29;
            194: result := 29;
            195: result := 29;
            196: result := 29;
            197: result := 29;
            198: result := 29;
            199: result := 29;
            200: result := 29;
            201: result := 29;
            202: result := 29;
            203: result := 29;
            204: result := 29;
            205: result := 29;
            206: result := 29;
            207: result := 29;
            208: result := 29;
            209: result := 29;
            210: result := 29;
            211: result := 29;
            212: result := 29;
            213: result := 29;
            214: result := 29;
            215: result := 29;
            216: result := 29;
            217: result := 29;
            218: result := 29;
            219: result := 29;
            220: result := 29;
            221: result := 29;
            222: result := 29;
            223: result := 29;
            224: result := 29;
            225: result := 29;
            226: result := 29;
            227: result := 29;
            228: result := 29;
            229: result := 29;
            230: result := 29;
            231: result := 29;
            232: result := 29;
            233: result := 29;
            234: result := 29;
            235: result := 29;
            236: result := 29;
            237: result := 29;
            238: result := 29;
            239: result := 29;
            240: result := 29;
            241: result := 29;
            242: result := 29;
            243: result := 29;
            244: result := 29;
            245: result := 29;
            246: result := 29;
            247: result := 29;
            248: result := 29;
            249: result := 29;
            250: result := 29;
            251: result := 29;
            252: result := 29;
            253: result := 29;
            254: result := 29;
            255: result := 29;
            else result := -1;
        end;
        30: case integer(c) of
            9: result := 37;
            13: result := 37;
            32: result := 37;
            33: result := 37;
            34: result := 37;
            35: result := 37;
            36: result := 37;
            37: result := 37;
            38: result := 37;
            39: result := 37;
            40: result := 37;
            41: result := 37;
            42: result := 37;
            43: result := 37;
            44: result := 37;
            45: result := 37;
            46: result := 37;
            47: result := 30;
            48: result := 37;
            49: result := 37;
            50: result := 37;
            51: result := 37;
            52: result := 37;
            53: result := 37;
            54: result := 37;
            55: result := 37;
            56: result := 37;
            57: result := 37;
            58: result := 37;
            59: result := 37;
            60: result := 37;
            61: result := 37;
            62: result := 37;
            63: result := 37;
            64: result := 37;
            65: result := 37;
            66: result := 37;
            67: result := 37;
            68: result := 37;
            69: result := 37;
            70: result := 37;
            71: result := 37;
            72: result := 37;
            73: result := 37;
            74: result := 37;
            75: result := 37;
            76: result := 37;
            77: result := 37;
            78: result := 37;
            79: result := 37;
            80: result := 37;
            81: result := 37;
            82: result := 37;
            83: result := 37;
            84: result := 37;
            85: result := 37;
            86: result := 37;
            87: result := 37;
            88: result := 37;
            89: result := 37;
            90: result := 37;
            91: result := 37;
            92: result := 37;
            93: result := 37;
            94: result := 37;
            95: result := 37;
            96: result := 37;
            97: result := 37;
            98: result := 37;
            99: result := 37;
            100: result := 37;
            101: result := 37;
            102: result := 37;
            103: result := 37;
            104: result := 37;
            105: result := 37;
            106: result := 37;
            107: result := 37;
            108: result := 37;
            109: result := 37;
            110: result := 37;
            111: result := 37;
            112: result := 37;
            113: result := 37;
            114: result := 37;
            115: result := 37;
            116: result := 37;
            117: result := 37;
            118: result := 37;
            119: result := 37;
            120: result := 37;
            121: result := 37;
            122: result := 37;
            123: result := 37;
            124: result := 37;
            125: result := 37;
            126: result := 37;
            161: result := 37;
            162: result := 37;
            163: result := 37;
            164: result := 37;
            165: result := 37;
            166: result := 37;
            167: result := 37;
            168: result := 37;
            169: result := 37;
            170: result := 37;
            171: result := 37;
            172: result := 37;
            173: result := 37;
            174: result := 37;
            175: result := 37;
            176: result := 37;
            177: result := 37;
            178: result := 37;
            179: result := 37;
            180: result := 37;
            181: result := 37;
            182: result := 37;
            183: result := 37;
            184: result := 37;
            185: result := 37;
            186: result := 37;
            187: result := 37;
            188: result := 37;
            189: result := 37;
            190: result := 37;
            191: result := 37;
            192: result := 37;
            193: result := 37;
            194: result := 37;
            195: result := 37;
            196: result := 37;
            197: result := 37;
            198: result := 37;
            199: result := 37;
            200: result := 37;
            201: result := 37;
            202: result := 37;
            203: result := 37;
            204: result := 37;
            205: result := 37;
            206: result := 37;
            207: result := 37;
            208: result := 37;
            209: result := 37;
            210: result := 37;
            211: result := 37;
            212: result := 37;
            213: result := 37;
            214: result := 37;
            215: result := 37;
            216: result := 37;
            217: result := 37;
            218: result := 37;
            219: result := 37;
            220: result := 37;
            221: result := 37;
            222: result := 37;
            223: result := 37;
            224: result := 37;
            225: result := 37;
            226: result := 37;
            227: result := 37;
            228: result := 37;
            229: result := 37;
            230: result := 37;
            231: result := 37;
            232: result := 37;
            233: result := 37;
            234: result := 37;
            235: result := 37;
            236: result := 37;
            237: result := 37;
            238: result := 37;
            239: result := 37;
            240: result := 37;
            241: result := 37;
            242: result := 37;
            243: result := 37;
            244: result := 37;
            245: result := 37;
            246: result := 37;
            247: result := 37;
            248: result := 37;
            249: result := 37;
            250: result := 37;
            251: result := 37;
            252: result := 37;
            253: result := 37;
            254: result := 37;
            255: result := 37;
            else result := -1;
        end;
        31: case integer(c) of
            48: result := 38;
            49: result := 39;
            50: result := 39;
            51: result := 39;
            52: result := 39;
            53: result := 39;
            54: result := 39;
            55: result := 39;
            56: result := 39;
            57: result := 39;
            else result := -1;
        end;
        33: case integer(c) of
            48: result := 21;
            49: result := 21;
            50: result := 21;
            51: result := 21;
            52: result := 21;
            53: result := 21;
            54: result := 21;
            55: result := 21;
            56: result := 21;
            57: result := 21;
            65: result := 21;
            66: result := 21;
            67: result := 21;
            68: result := 21;
            69: result := 21;
            70: result := 21;
            71: result := 21;
            72: result := 21;
            73: result := 21;
            74: result := 21;
            75: result := 21;
            76: result := 21;
            77: result := 21;
            78: result := 21;
            79: result := 21;
            80: result := 21;
            81: result := 21;
            82: result := 21;
            83: result := 21;
            84: result := 21;
            85: result := 21;
            86: result := 21;
            87: result := 21;
            88: result := 21;
            89: result := 21;
            90: result := 21;
            97: result := 21;
            98: result := 21;
            99: result := 21;
            100: result := 21;
            101: result := 21;
            102: result := 21;
            103: result := 21;
            104: result := 21;
            105: result := 21;
            106: result := 21;
            107: result := 21;
            108: result := 21;
            109: result := 21;
            110: result := 21;
            111: result := 21;
            112: result := 21;
            113: result := 21;
            114: result := 21;
            115: result := 21;
            116: result := 21;
            117: result := 21;
            118: result := 21;
            119: result := 21;
            120: result := 21;
            121: result := 21;
            122: result := 21;
            else result := -1;
        end;
        34: case integer(c) of
            48: result := 34;
            49: result := 34;
            else result := -1;
        end;
        35: case integer(c) of
            48: result := 35;
            49: result := 35;
            50: result := 35;
            51: result := 35;
            52: result := 35;
            53: result := 35;
            54: result := 35;
            55: result := 35;
            56: result := 35;
            57: result := 35;
            97: result := 35;
            98: result := 35;
            99: result := 35;
            100: result := 35;
            101: result := 35;
            102: result := 35;
            else result := -1;
        end;
        36: case integer(c) of
            9: result := 29;
            10: result := 29;
            13: result := 29;
            32: result := 29;
            33: result := 29;
            35: result := 29;
            36: result := 29;
            37: result := 29;
            38: result := 29;
            39: result := 29;
            40: result := 29;
            41: result := 29;
            42: result := 40;
            43: result := 29;
            44: result := 29;
            45: result := 29;
            46: result := 29;
            47: result := 41;
            48: result := 29;
            49: result := 29;
            50: result := 29;
            51: result := 29;
            52: result := 29;
            53: result := 29;
            54: result := 29;
            55: result := 29;
            56: result := 29;
            57: result := 29;
            58: result := 29;
            59: result := 29;
            60: result := 29;
            61: result := 29;
            62: result := 29;
            63: result := 29;
            64: result := 29;
            65: result := 29;
            66: result := 29;
            67: result := 29;
            68: result := 29;
            69: result := 29;
            70: result := 29;
            71: result := 29;
            72: result := 29;
            73: result := 29;
            74: result := 29;
            75: result := 29;
            76: result := 29;
            77: result := 29;
            78: result := 29;
            79: result := 29;
            80: result := 29;
            81: result := 29;
            82: result := 29;
            83: result := 29;
            84: result := 29;
            85: result := 29;
            86: result := 29;
            87: result := 29;
            88: result := 29;
            89: result := 29;
            90: result := 29;
            91: result := 29;
            92: result := 29;
            93: result := 29;
            94: result := 29;
            95: result := 29;
            96: result := 29;
            97: result := 29;
            98: result := 29;
            99: result := 29;
            100: result := 29;
            101: result := 29;
            102: result := 29;
            103: result := 29;
            104: result := 29;
            105: result := 29;
            106: result := 29;
            107: result := 29;
            108: result := 29;
            109: result := 29;
            110: result := 29;
            111: result := 29;
            112: result := 29;
            113: result := 29;
            114: result := 29;
            115: result := 29;
            116: result := 29;
            117: result := 29;
            118: result := 29;
            119: result := 29;
            120: result := 29;
            121: result := 29;
            122: result := 29;
            123: result := 29;
            124: result := 29;
            125: result := 29;
            126: result := 29;
            161: result := 29;
            162: result := 29;
            163: result := 29;
            164: result := 29;
            165: result := 29;
            166: result := 29;
            167: result := 29;
            168: result := 29;
            169: result := 29;
            170: result := 29;
            171: result := 29;
            172: result := 29;
            173: result := 29;
            174: result := 29;
            175: result := 29;
            176: result := 29;
            177: result := 29;
            178: result := 29;
            179: result := 29;
            180: result := 29;
            181: result := 29;
            182: result := 29;
            183: result := 29;
            184: result := 29;
            185: result := 29;
            186: result := 29;
            187: result := 29;
            188: result := 29;
            189: result := 29;
            190: result := 29;
            191: result := 29;
            192: result := 29;
            193: result := 29;
            194: result := 29;
            195: result := 29;
            196: result := 29;
            197: result := 29;
            198: result := 29;
            199: result := 29;
            200: result := 29;
            201: result := 29;
            202: result := 29;
            203: result := 29;
            204: result := 29;
            205: result := 29;
            206: result := 29;
            207: result := 29;
            208: result := 29;
            209: result := 29;
            210: result := 29;
            211: result := 29;
            212: result := 29;
            213: result := 29;
            214: result := 29;
            215: result := 29;
            216: result := 29;
            217: result := 29;
            218: result := 29;
            219: result := 29;
            220: result := 29;
            221: result := 29;
            222: result := 29;
            223: result := 29;
            224: result := 29;
            225: result := 29;
            226: result := 29;
            227: result := 29;
            228: result := 29;
            229: result := 29;
            230: result := 29;
            231: result := 29;
            232: result := 29;
            233: result := 29;
            234: result := 29;
            235: result := 29;
            236: result := 29;
            237: result := 29;
            238: result := 29;
            239: result := 29;
            240: result := 29;
            241: result := 29;
            242: result := 29;
            243: result := 29;
            244: result := 29;
            245: result := 29;
            246: result := 29;
            247: result := 29;
            248: result := 29;
            249: result := 29;
            250: result := 29;
            251: result := 29;
            252: result := 29;
            253: result := 29;
            254: result := 29;
            255: result := 29;
            else result := -1;
        end;
        37: case integer(c) of
            9: result := 37;
            13: result := 37;
            32: result := 37;
            33: result := 37;
            34: result := 37;
            35: result := 37;
            36: result := 37;
            37: result := 37;
            38: result := 37;
            39: result := 37;
            40: result := 37;
            41: result := 37;
            42: result := 37;
            43: result := 37;
            44: result := 37;
            45: result := 37;
            46: result := 37;
            47: result := 37;
            48: result := 37;
            49: result := 37;
            50: result := 37;
            51: result := 37;
            52: result := 37;
            53: result := 37;
            54: result := 37;
            55: result := 37;
            56: result := 37;
            57: result := 37;
            58: result := 37;
            59: result := 37;
            60: result := 37;
            61: result := 37;
            62: result := 37;
            63: result := 37;
            64: result := 37;
            65: result := 37;
            66: result := 37;
            67: result := 37;
            68: result := 37;
            69: result := 37;
            70: result := 37;
            71: result := 37;
            72: result := 37;
            73: result := 37;
            74: result := 37;
            75: result := 37;
            76: result := 37;
            77: result := 37;
            78: result := 37;
            79: result := 37;
            80: result := 37;
            81: result := 37;
            82: result := 37;
            83: result := 37;
            84: result := 37;
            85: result := 37;
            86: result := 37;
            87: result := 37;
            88: result := 37;
            89: result := 37;
            90: result := 37;
            91: result := 37;
            92: result := 37;
            93: result := 37;
            94: result := 37;
            95: result := 37;
            96: result := 37;
            97: result := 37;
            98: result := 37;
            99: result := 37;
            100: result := 37;
            101: result := 37;
            102: result := 37;
            103: result := 37;
            104: result := 37;
            105: result := 37;
            106: result := 37;
            107: result := 37;
            108: result := 37;
            109: result := 37;
            110: result := 37;
            111: result := 37;
            112: result := 37;
            113: result := 37;
            114: result := 37;
            115: result := 37;
            116: result := 37;
            117: result := 37;
            118: result := 37;
            119: result := 37;
            120: result := 37;
            121: result := 37;
            122: result := 37;
            123: result := 37;
            124: result := 37;
            125: result := 37;
            126: result := 37;
            161: result := 37;
            162: result := 37;
            163: result := 37;
            164: result := 37;
            165: result := 37;
            166: result := 37;
            167: result := 37;
            168: result := 37;
            169: result := 37;
            170: result := 37;
            171: result := 37;
            172: result := 37;
            173: result := 37;
            174: result := 37;
            175: result := 37;
            176: result := 37;
            177: result := 37;
            178: result := 37;
            179: result := 37;
            180: result := 37;
            181: result := 37;
            182: result := 37;
            183: result := 37;
            184: result := 37;
            185: result := 37;
            186: result := 37;
            187: result := 37;
            188: result := 37;
            189: result := 37;
            190: result := 37;
            191: result := 37;
            192: result := 37;
            193: result := 37;
            194: result := 37;
            195: result := 37;
            196: result := 37;
            197: result := 37;
            198: result := 37;
            199: result := 37;
            200: result := 37;
            201: result := 37;
            202: result := 37;
            203: result := 37;
            204: result := 37;
            205: result := 37;
            206: result := 37;
            207: result := 37;
            208: result := 37;
            209: result := 37;
            210: result := 37;
            211: result := 37;
            212: result := 37;
            213: result := 37;
            214: result := 37;
            215: result := 37;
            216: result := 37;
            217: result := 37;
            218: result := 37;
            219: result := 37;
            220: result := 37;
            221: result := 37;
            222: result := 37;
            223: result := 37;
            224: result := 37;
            225: result := 37;
            226: result := 37;
            227: result := 37;
            228: result := 37;
            229: result := 37;
            230: result := 37;
            231: result := 37;
            232: result := 37;
            233: result := 37;
            234: result := 37;
            235: result := 37;
            236: result := 37;
            237: result := 37;
            238: result := 37;
            239: result := 37;
            240: result := 37;
            241: result := 37;
            242: result := 37;
            243: result := 37;
            244: result := 37;
            245: result := 37;
            246: result := 37;
            247: result := 37;
            248: result := 37;
            249: result := 37;
            250: result := 37;
            251: result := 37;
            252: result := 37;
            253: result := 37;
            254: result := 37;
            255: result := 37;
            else result := -1;
        end;
        38: case integer(c) of
            48: result := 42;
            49: result := 39;
            50: result := 39;
            51: result := 39;
            52: result := 39;
            53: result := 39;
            54: result := 39;
            55: result := 39;
            56: result := 39;
            57: result := 39;
            else result := -1;
        end;
        39: case integer(c) of
            48: result := 42;
            49: result := 39;
            50: result := 39;
            51: result := 39;
            52: result := 39;
            53: result := 39;
            54: result := 39;
            55: result := 39;
            56: result := 39;
            57: result := 39;
            else result := -1;
        end;
        40: case integer(c) of
            9: result := 29;
            10: result := 29;
            13: result := 29;
            32: result := 29;
            33: result := 29;
            35: result := 29;
            36: result := 29;
            37: result := 29;
            38: result := 29;
            39: result := 29;
            40: result := 29;
            41: result := 29;
            42: result := 40;
            43: result := 29;
            44: result := 29;
            45: result := 29;
            46: result := 29;
            48: result := 29;
            49: result := 29;
            50: result := 29;
            51: result := 29;
            52: result := 29;
            53: result := 29;
            54: result := 29;
            55: result := 29;
            56: result := 29;
            57: result := 29;
            58: result := 29;
            59: result := 29;
            60: result := 29;
            61: result := 29;
            62: result := 29;
            63: result := 29;
            64: result := 29;
            65: result := 29;
            66: result := 29;
            67: result := 29;
            68: result := 29;
            69: result := 29;
            70: result := 29;
            71: result := 29;
            72: result := 29;
            73: result := 29;
            74: result := 29;
            75: result := 29;
            76: result := 29;
            77: result := 29;
            78: result := 29;
            79: result := 29;
            80: result := 29;
            81: result := 29;
            82: result := 29;
            83: result := 29;
            84: result := 29;
            85: result := 29;
            86: result := 29;
            87: result := 29;
            88: result := 29;
            89: result := 29;
            90: result := 29;
            91: result := 29;
            92: result := 29;
            93: result := 29;
            94: result := 29;
            95: result := 29;
            96: result := 29;
            97: result := 29;
            98: result := 29;
            99: result := 29;
            100: result := 29;
            101: result := 29;
            102: result := 29;
            103: result := 29;
            104: result := 29;
            105: result := 29;
            106: result := 29;
            107: result := 29;
            108: result := 29;
            109: result := 29;
            110: result := 29;
            111: result := 29;
            112: result := 29;
            113: result := 29;
            114: result := 29;
            115: result := 29;
            116: result := 29;
            117: result := 29;
            118: result := 29;
            119: result := 29;
            120: result := 29;
            121: result := 29;
            122: result := 29;
            123: result := 29;
            124: result := 29;
            125: result := 29;
            126: result := 29;
            161: result := 29;
            162: result := 29;
            163: result := 29;
            164: result := 29;
            165: result := 29;
            166: result := 29;
            167: result := 29;
            168: result := 29;
            169: result := 29;
            170: result := 29;
            171: result := 29;
            172: result := 29;
            173: result := 29;
            174: result := 29;
            175: result := 29;
            176: result := 29;
            177: result := 29;
            178: result := 29;
            179: result := 29;
            180: result := 29;
            181: result := 29;
            182: result := 29;
            183: result := 29;
            184: result := 29;
            185: result := 29;
            186: result := 29;
            187: result := 29;
            188: result := 29;
            189: result := 29;
            190: result := 29;
            191: result := 29;
            192: result := 29;
            193: result := 29;
            194: result := 29;
            195: result := 29;
            196: result := 29;
            197: result := 29;
            198: result := 29;
            199: result := 29;
            200: result := 29;
            201: result := 29;
            202: result := 29;
            203: result := 29;
            204: result := 29;
            205: result := 29;
            206: result := 29;
            207: result := 29;
            208: result := 29;
            209: result := 29;
            210: result := 29;
            211: result := 29;
            212: result := 29;
            213: result := 29;
            214: result := 29;
            215: result := 29;
            216: result := 29;
            217: result := 29;
            218: result := 29;
            219: result := 29;
            220: result := 29;
            221: result := 29;
            222: result := 29;
            223: result := 29;
            224: result := 29;
            225: result := 29;
            226: result := 29;
            227: result := 29;
            228: result := 29;
            229: result := 29;
            230: result := 29;
            231: result := 29;
            232: result := 29;
            233: result := 29;
            234: result := 29;
            235: result := 29;
            236: result := 29;
            237: result := 29;
            238: result := 29;
            239: result := 29;
            240: result := 29;
            241: result := 29;
            242: result := 29;
            243: result := 29;
            244: result := 29;
            245: result := 29;
            246: result := 29;
            247: result := 29;
            248: result := 29;
            249: result := 29;
            250: result := 29;
            251: result := 29;
            252: result := 29;
            253: result := 29;
            254: result := 29;
            255: result := 29;
            else result := -1;
        end;
        42: case integer(c) of
            48: result := 42;
            49: result := 39;
            50: result := 39;
            51: result := 39;
            52: result := 39;
            53: result := 39;
            54: result := 39;
            55: result := 39;
            56: result := 39;
            57: result := 39;
            else result := -1;
        end;
        else result := -1;
    end;
end;

function TLexico.tokenForState(state : integer) : integer;
begin
    if (state >= 0) and (state < STATES_COUNT) then
        result := TOKEN_STATE[state]
    else
        result := -1;
end;

function TLexico.lookupToken(base : integer; key : string) : integer;
var
    start, end_, half : integer;
    str : string;
begin
    result := base;

    start := SPECIAL_CASES_INDEXES[base];
    end_  := SPECIAL_CASES_INDEXES[base+1]-1;

    while start <= end_ do
    begin
        half := (start+end_) div 2;
        str := SPECIAL_CASES_KEYS[half];

        if str = key then
        begin
            result := SPECIAL_CASES_VALUES[half];
            break;
        end
        else if str < key then
            start := half+1
        else  //str > key
            end_ := half-1;
    end;
end;

function TLexico.hasInput : boolean;
begin
    result := position <= endPos;
end;

function TLexico.nextChar : char;
begin
    if hasInput then
    begin
        result := input[position];
        position := position + 1;
    end
    else
        result := char(0);
end;

end.
